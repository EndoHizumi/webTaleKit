# CLINE RULES

## 役割

あなたは、 TypeScript のエキスパートであるエンジニアです。
日本語で応答しつつ、タスクの進め方を元に効率的にコーディングを進めてください。
調査結果は、.clinerules ファイルに追記してください。

## タスクの進め方

1. ブランチを切る
2. タスクを実装する
　1. webTaleKitをビルドする
  2. サンプルゲームをビルドして動作確認を行う
3. PlayWrightでテストを書く
4. テストを通す
5. プルリクエストを作成する

## プロジェクト概要

WebTaleKitはブラウザで動作するビジュアルノベルゲームエンジンです。
ゲームはsceneファイルと呼ばれるXMLとJavaScriptの組み合わせで記述されます。
ここで記述されるXMLはwebTaleScriptと呼ばれる独自のスクリプト言語で、ゲームの進行制御を記述します。

sceneファイルは以下の要素を持ちます。
- scenario: シナリオを記述します。テキスト、選択肢、遷移先などを記述します。
- script: シーンの設定を記述します。背景画像、BGM、テンプレートファイルなどを指定します。（webTaleScriptから呼び出すJavaScriptもここで記述します。）

主要なディレクトリ構成は以下の通りです。
- src
 - core: ゲームエンジンのコア部分です。
 - resource: ゲームで使用するリソースを管理するモジュールです。
 - utils: ゲームで使用するユーティリティ関数(ロガーや待機、値共有用のStore)を管理するモジュールです。
- example: サンプルゲームが配置されています。動作確認もここで行います。

## メッセージウィンドウの改善点

### 現在の実装状況
- メッセージウィンドウは `example/src/screen/title.html` で定義されています
- メッセージウィンドウ（#messageWindow）は画面下部に配置され、幅100%、高さは画面の1/4（calc(720px / 4)）
- メッセージテキスト（#messageView）はpタグとして実装され、パディングのみ設定されています
- テキスト表示処理は `src/core/drawer.ts` の `drawText` メソッドで行われ、1文字ずつテキストを追加しています

### 問題点
1. **テキスト表示領域の制限がない**:
   - `#messageView` に幅と高さの制限が設定されていないため、テキストが長くなるとメッセージウィンドウの表示領域を超えてしまう
   
2. **テキスト折り返しの設定不足**:
   - テキストの折り返しに関する設定（word-wrap, word-breakなど）が不足しています
   
3. **自動スクロール処理の欠如**:
   - `overflow-y: auto` が設定されているため、テキストが長くなるとスクロールバーは表示されますが、自動的にスクロールする処理は実装されていません

### 修正案
1. **CSSの改善**:
   - `#messageView` に幅と高さの制限を追加
   - テキスト折り返しの設定を追加（overflow-wrap, word-break）
   
2. **drawTextメソッドの改善**:
   - テキスト追加時にメッセージウィンドウの表示領域を超えないかチェック
   - 必要に応じて自動スクロール処理を追加

### 修正対象ファイル
- `example/src/screen/title.html`: CSSスタイルの修正
- `src/core/drawer.ts`: drawTextメソッドの改善